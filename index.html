<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CGPA Converter (Years 1–4, Sem 1–2)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b1220; --surface:#0f1628; --card:#121a2b; --soft:#1b2540; --border:#223055;
      --text:#e8ecf1; --muted:#a6b0c3; --accent:#6aa6ff; --accent2:#3d68ff;
      --ok:#3ddc97; --warn:#ffb020; --bad:#ff6b6b; --chip:#0f1730;
      --shadow: 0 8px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% -10%, rgba(61,104,255,.12), transparent 60%),
        radial-gradient(1000px 600px at 110% 10%, rgba(106,166,255,.10), transparent 60%),
        var(--bg);
    }

    /* Header */
    .hero{
      max-width:1200px; margin:24px auto 8px; padding:0 16px;
      text-align:center;
    }
    .title{
      display:inline-flex; align-items:center; gap:12px;
      font-weight:800; font-size:clamp(22px, 3vw, 34px);
      padding:10px 16px; border-radius:14px;
      background:linear-gradient(180deg, rgba(106,166,255,.10), rgba(61,104,255,.08));
      border:1px solid var(--border);
      box-shadow:var(--shadow);
    }
    .subtitle{ color:var(--muted); margin:10px auto 22px; max-width:820px }

    /* Shell */
    .wrap{ max-width:1200px; margin:0 auto 28px; padding:0 16px; }
    .grid{ display:grid; gap:16px; grid-template-columns:1.05fr 1fr; }
    @media (max-width: 980px){ .grid{ grid-template-columns:1fr } }

    .card{
      background:linear-gradient(180deg, rgba(18,26,43,.98), rgba(15,22,40,.98));
      border:1px solid var(--border); border-radius:18px; padding:16px;
      box-shadow:var(--shadow);
    }
    .card h2{ margin:2px 0 14px; font-size:18px }

    /* Forms */
    label{ display:block; font-size:13px; color:var(--muted); margin:6px 0 6px }
    input, select{
      width:100%; padding:12px 12px; border-radius:12px; border:1px solid var(--soft);
      background:var(--chip); color:var(--text); outline:none;
    }
    input:focus, select:focus{ border-color:var(--accent); box-shadow:0 0 0 2px rgba(106,166,255,.15) }

    .row-2{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
    .row-5{ display:grid; grid-template-columns:repeat(5, 1fr); gap:8px }
    @media (max-width: 760px){ .row-5{ grid-template-columns:1fr 1fr } }

    .btn{
      cursor:pointer; padding:12px 16px; border-radius:12px; border:1px solid var(--accent);
      color:#fff; font-weight:700; letter-spacing:.2px;
      background:linear-gradient(90deg, var(--accent2), var(--accent));
      transition:.15s transform ease, .2s filter ease;
    }
    .btn:hover{ filter:brightness(1.08) }
    .btn:active{ transform:translateY(1px) }
    .btn.secondary{
      background:transparent; border-color:var(--soft); color:var(--text); font-weight:600;
    }

    .flash{ padding:12px 14px; border-radius:12px; margin:0 auto 14px; max-width:760px }
    .flash.success{ background:#10261e; border:1px solid #214c3b; color:#bff5db }
    .flash.danger{ background:#2a1313; border:1px solid #5b2525; color:#ffd9d9 }

    /* Pills / chips */
    .pill{
      display:inline-flex; gap:6px; align-items:center; justify-content:center;
      padding:6px 12px; border-radius:999px; border:1px solid var(--soft);
      background:var(--chip); font-size:13px;
    }
    .ok{ color:var(--ok); border-color:#2a6d55; background:#0f1f19 }
    .bad{ color:var(--bad); border-color:#6d2a2a; background:#1f0e0e }

    /* Table */
    table{ width:100%; border-collapse:collapse; overflow:hidden; border-radius:12px; }
    thead th{
      font-size:12.5px; color:var(--muted); text-transform:uppercase; letter-spacing:.5px;
      background:#0e1527; border-bottom:1px solid var(--soft); padding:10px;
    }
    tbody td{
      padding:11px 10px; text-align:center; border-bottom:1px solid var(--soft); font-size:14px;
    }

    .section-title{
      display:flex; align-items:center; gap:8px; font-weight:700; margin:0 0 8px;
    }
    .section-title .dot{ width:8px; height:8px; background:var(--accent); border-radius:50% }
    .hint{ color:var(--muted); font-size:13px }
    hr.sep{ border:none; border-top:1px solid var(--soft); margin:16px 0 }
    .mini{ font-size:12px; color:var(--muted) }

    /* Graph frame */
    .graph-frame{
      border:1px solid var(--border); border-radius:14px; overflow:hidden;
      background:linear-gradient(180deg, rgba(18,26,43,.9), rgba(14,22,40,.9));
    }
    .graph-frame img{ width:100%; display:block }
  </style>
</head>
<body>

  <!-- Centered Header -->
  <header class="hero">
    <div class="title">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M4 19h16M4 15h16M4 11h10M4 7h10" stroke="url(#g)" stroke-width="2" stroke-linecap="round"/>
        <defs><linearGradient id="g" x1="0" y1="0" x2="24" y2="24">
          <stop stop-color="#6aa6ff"/><stop offset="1" stop-color="#3d68ff"/></linearGradient></defs>
      </svg>
      CGPA Converter 
    </div>
    <p class="subtitle"></p>
  </header>

  <!-- Flash messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <main class="wrap">
    <section class="grid">
      <!-- LEFT: Form -->
      <div class="card">
        <h2 class="section-title"><span class="dot"></span> Enter Marks</h2>
        <form method="post" action="{{ url_for('submit') }}">
          <div class="row-2" style="margin-bottom:12px">
            <div>
              <label>Year</label>
              <select name="year" required>
                <option value="">Select</option>
                <option value="1">1st Year</option>
                <option value="2">2nd Year</option>
                <option value="3">3rd Year</option>
                <option value="4">4th Year</option>
              </select>
            </div>
            <div>
              <label>Semester</label>
              <select name="semester" required>
                <option value="">Select</option>
                <option value="1">Semester 1</option>
                <option value="2">Semester 2</option>
              </select>
            </div>
          </div>

          <label>Marks (Five Subjects)</label>
          <div class="row-5" style="margin-bottom:12px">
            <input type="number" name="m1" min="0" max="100" step="0.01" placeholder="Subject 1" required>
            <input type="number" name="m2" min="0" max="100" step="0.01" placeholder="Subject 2" required>
            <input type="number" name="m3" min="0" max="100" step="0.01" placeholder="Subject 3" required>
            <input type="number" name="m4" min="0" max="100" step="0.01" placeholder="Subject 4" required>
            <input type="number" name="m5" min="0" max="100" step="0.01" placeholder="Subject 5" required>
          </div>

          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
            <button class="btn" type="submit">Save Semester & Compute SGPA</button>
            <span id="preview" class="pill mini" title="Live SGPA preview (approx.)">SGPA Preview: —</span>
          </div>
        </form>

        <hr class="sep">

        <h2 class="section-title"><span class="dot"></span> Calculate a Year’s CGPA</h2>
        <form method="get" action="{{ url_for('index') }}" style="display:flex; gap:10px; flex-wrap:wrap">
          <select name="year_query" required>
            <option value="">Select Year</option>
            <option value="1" {% if selected_year == 1 %}selected{% endif %}>1st Year</option>
            <option value="2" {% if selected_year == 2 %}selected{% endif %}>2nd Year</option>
            <option value="3" {% if selected_year == 3 %}selected{% endif %}>3rd Year</option>
            <option value="4" {% if selected_year == 4 %}selected{% endif %}>4th Year</option>
          </select>
          <button class="btn secondary" type="submit">Show CGPA</button>
        </form>

        {% if selected_year %}
          <div style="margin-top:10px">
            <span class="hint">Year {{ selected_year }} CGPA:</span>
            {% if selected_year_cgpa is not none %}
              <span class="pill ok">{{ '%.2f'|format(selected_year_cgpa) }}</span>
            {% else %}
              <span class="pill bad">Both semesters not available</span>
            {% endif %}
          </div>
        {% endif %}
      </div>

      <!-- RIGHT: Graph + Summary -->
      <div class="card">
        <h2 class="section-title"><span class="dot"></span> Performance Graph</h2>
        <div class="graph-frame">
          <img src="{{ url_for('graph_png') }}" alt="SGPA Trend Graph">
        </div>

        <!-- NEW: Reset Graph button -->
        <form method="post" action="{{ url_for('reset_graph') }}" style="margin-top:10px; display:flex; justify-content:flex-end">
          <button class="btn secondary" type="submit" title="Clear all saved semesters and reset the graph">
            Reset Graph
          </button>
        </form>

        <div class="hint" style="margin-top:8px">Trend is shown as SGPA for each semester (1-1 → 4-2).</div>

        <hr class="sep">

        <h2 class="section-title"><span class="dot"></span> CGPA Summary</h2>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:8px">
          {% for y in [1,2,3,4] %}
            <div class="pill" style="justify-content:space-between">
              <span>Year {{ y }}</span>
              {% if year_cgpas[y] is not none %}
                <b>{{ '%.2f'|format(year_cgpas[y]) }}</b>
              {% else %}
                <span class="mini">need both semesters</span>
              {% endif %}
            </div>
          {% endfor %}
        </div>

        <div>
          Overall CGPA:
          {% if overall_cgpa is not none %}
            <span class="pill ok">{{ '%.2f'|format(overall_cgpa) }}</span>
          {% else %}
            <span class="pill bad">no data yet</span>
          {% endif %}
        </div>
      </div>
    </section>

    <!-- Saved Semesters -->
    <section class="card" style="margin-top:16px">
      <h2 class="section-title"><span class="dot"></span> Saved Semesters</h2>
      <table>
        <thead>
          <tr>
            <th>Year</th><th>Semester</th><th>Marks (5)</th><th>SGPA</th><th>Saved At</th>
          </tr>
        </thead>
        <tbody>
        {% for row in table_rows %}
          <tr>
            <td>{{ row.year }}</td>
            <td>{{ row.semester }}</td>
            <td>
              {% if row.marks %}
                {{ row.marks[0] }}, {{ row.marks[1] }}, {{ row.marks[2] }}, {{ row.marks[3] }}, {{ row.marks[4] }}
              {% else %}<span class="mini">—</span>{% endif %}
            </td>
            <td>{% if row.sgpa %}<b>{{ row.sgpa }}</b>{% else %}<span class="mini">—</span>{% endif %}</td>
            <td>{{ row.timestamp if row.timestamp else '—' }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>

      <p class="mini" style="margin-top:10px">
        Grade conversion used here (out of 10): 90+=10, 80–89=9, 70–79=8, 60–69=7, 50–59=6, 40–49=5, &lt;40=0.
        Change it in <code>app.py</code> if your university uses different thresholds.
      </p>
    </section>
  </main>

  <!-- Live SGPA preview (client-side) -->
  <script>
    const inputs = Array.from(document.querySelectorAll('input[name^="m"]'));
    const preview = document.getElementById('preview');

    function marksToGP(m){
      const x = parseFloat(m);
      if (isNaN(x)) return null;
      if (x >= 90) return 10;
      if (x >= 80) return 9;
      if (x >= 70) return 8;
      if (x >= 60) return 7;
      if (x >= 50) return 6;
      if (x >= 40) return 5;
      return 0;
    }
    function refreshPreview(){
      const vals = inputs.map(i => i.value.trim()).map(v => v===''?null:parseFloat(v));
      if (vals.some(v => v===null)) { preview.textContent = 'SGPA Preview: —'; return; }
      const gps = vals.map(marksToGP);
      if (gps.some(g => g===null)) { preview.textContent = 'SGPA Preview: —'; return; }
      const sgpa = gps.reduce((a,b)=>a+b,0) / gps.length;
      preview.textContent = 'SGPA Preview: ' + sgpa.toFixed(2);
    }
    inputs.forEach(i => i.addEventListener('input', refreshPreview));
  </script>
</body>
</html>
